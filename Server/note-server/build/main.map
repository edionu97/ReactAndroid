{"version":3,"sources":["webpack:///webpack/bootstrap 5e59881cf993a96d5d69","webpack:///./src/index.js","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"koa\"","webpack:///external \"http\"","webpack:///external \"ws\"","webpack:///external \"koa-router\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-bodyparser\""],"names":["Koa","require","app","server","createServer","callback","WebSocket","wss","Server","Router","cors","bodyparser","use","ctx","next","start","Date","ms","console","log","method","url","response","status","body","issue","error","message","Note","id","text","date","version","notes","i","push","now","lastUpdated","length","lastId","pageSize","broadcast","clients","forEach","client","readyState","OPEN","send","JSON","stringify","data","router","get","ifModifiedSince","request","getTime","getMilliseconds","query","page","parseInt","set","toUTCString","sortedNotes","filter","note","indexOf","sort","n1","n2","offset","slice","more","noteId","params","find","warning","createNote","event","post","put","index","findIndex","noteVersion","del","splice","setInterval","routes","allowedMethods","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5e59881cf993a96d5d69","const Koa = require('koa');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({ server });\r\nconst Router = require('koa-router');\r\nconst cors = require('koa-cors');\r\nconst bodyparser = require('koa-bodyparser');\r\n\r\napp.use(bodyparser()); //1\r\napp.use(cors()); //2\r\napp.use(async (ctx, next) => { // logger\r\n  const start = new Date();\r\n  await next();\r\n  const ms = new Date() - start;\r\n  console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n});\r\n\r\napp.use(async (ctx, next) => { // error handler\r\n  try {\r\n    await next();\r\n  } catch (err) {\r\n    ctx.response.body = { issue: [{ error: err.message || 'Unexpected error' }] };\r\n    ctx.response.status = 500; // internal server error\r\n  }\r\n});\r\n\r\nclass Note {\r\n  constructor({ id, text, date, version }) {\r\n    this.id = id;\r\n    this.text = text;\r\n    this.date = date;\r\n    this.version = version;\r\n  }\r\n}\r\n\r\nconst notes = [];\r\nfor (let i = 0; i < 21; i++) {\r\n  notes.push(new Note({ id: `${i}`, text: `Note ${i}`, date: new Date(Date.now() + i), version: 1 }));\r\n}\r\nlet lastUpdated = notes[notes.length - 1].date;\r\nlet lastId = notes[notes.length - 1].id;\r\nconst pageSize = 10;\r\n\r\nconst broadcast = data =>\r\n  wss.clients.forEach(client => {\r\n    if (client.readyState === WebSocket.OPEN) {\r\n      client.send(JSON.stringify(data));\r\n    }\r\n  });\r\n\r\nconst router = new Router();\r\nrouter.get('/note', ctx => {\r\n  const ifModifiedSince = ctx.request.get('If-Modified-Since');\r\n  if (ifModifiedSince && new Date(ifModifiedSince).getTime() >= lastUpdated.getTime() - lastUpdated.getMilliseconds()) {\r\n    ctx.response.status = 304; // NOT MODIFIED\r\n    return;\r\n  }\r\n  const text = ctx.request.query.text;\r\n  const page = parseInt(ctx.request.query.page) || 1;\r\n  ctx.response.set('Last-Modified', lastUpdated.toUTCString());\r\n  const sortedNotes = notes\r\n    .filter(note => text ? note.text.indexOf(text) !== -1 : true)\r\n    .sort((n1, n2) => -(n1.date.getTime() - n2.date.getTime()));\r\n  const offset = (page - 1) * pageSize;\r\n  ctx.response.body = {\r\n    page,\r\n    notes: sortedNotes.slice(offset, offset + pageSize),\r\n    more: offset + pageSize < sortedNotes.length\r\n  };\r\n  ctx.response.status = 200; // OK\r\n});\r\n\r\nrouter.get('/note/:id', async (ctx) => {\r\n  const noteId = ctx.request.params.id;\r\n  const note = notes.find(note => noteId === note.id);\r\n  if (note) {\r\n    ctx.response.body = note;\r\n    ctx.response.status = 200; // ok\r\n  } else {\r\n    ctx.response.body = { issue: [{ warning: `Note with id ${noteId} not found` }] };\r\n    ctx.response.status = 404; // NOT FOUND (if you know the resource was deleted, then return 410 GONE)\r\n  }\r\n});\r\n\r\nconst createNote = async (ctx) => {\r\n  const note = ctx.request.body;\r\n  if (!note.text) { // validation\r\n    ctx.response.body = { issue: [{ error: 'Text is missing' }] };\r\n    ctx.response.status = 400; //  BAD REQUEST\r\n    return;\r\n  }\r\n  note.id = `${parseInt(lastId) + 1}`;\r\n  lastId = note.id;\r\n  note.date = Date.now();\r\n  note.version = 1;\r\n  notes.push(note);\r\n  ctx.response.body = note;\r\n  ctx.response.status = 201; // CREATED\r\n  broadcast({ event: 'created', note });\r\n};\r\n\r\nrouter.post('/note', async (ctx) => {\r\n  await createNote(ctx);\r\n});\r\n\r\nrouter.put('/note/:id', async (ctx) => {\r\n  const id = ctx.params.id;\r\n  const note = ctx.request.body;\r\n  const noteId = note.id;\r\n  if (noteId && id !== note.id) {\r\n    ctx.response.body = { issue: [{ error: `Param id and body id should be the same` }] };\r\n    ctx.response.status = 400; // BAD REQUEST\r\n    return;\r\n  }\r\n  if (!noteId) {\r\n    await createNote(ctx);\r\n    return;\r\n  }\r\n  const index = notes.findIndex(note => note.id === id);\r\n  if (index === -1) {\r\n    ctx.response.body = { issue: [{ error: `Note with id ${id} not found` }] };\r\n    ctx.response.status = 400; // BAD REQUEST\r\n    return;\r\n  }\r\n  const noteVersion = parseInt(ctx.request.get('ETag')) || note.version;\r\n  if (noteVersion < notes[index].version) {\r\n    ctx.response.body = { issue: [{ error: `Version conflict` }] };\r\n    ctx.response.status = 409; // CONFLICT\r\n    return;\r\n  }\r\n  note.version++;\r\n  notes[index] = note;\r\n  lastUpdated = new Date();\r\n  ctx.response.body = note;\r\n  ctx.response.status = 200; // OK\r\n  broadcast({ event: 'updated', note });\r\n});\r\n\r\nrouter.del('/note/:id', ctx => {\r\n  const id = ctx.params.id;\r\n  const index = notes.findIndex(note => id === note.id);\r\n  if (index !== -1) {\r\n    const note = notes[index];\r\n    notes.splice(index, 1);\r\n    lastUpdated = new Date();\r\n    broadcast({ event: 'deleted', note });\r\n  }\r\n  ctx.response.status = 204; // no content\r\n});\r\n\r\nsetInterval(() => {\r\n  lastUpdated = new Date();\r\n  lastId = `${parseInt(lastId) + 1}`;\r\n  const note = new Note({ id: lastId, text: `Note ${lastId}`, date: lastUpdated, version: 1 });\r\n  notes.push(note);\r\n  console.log(`\r\n   ${note.text}`);\r\n  broadcast({ event: 'created', note });\r\n}, 15000);\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(3000);\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 2\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 9\n// module chunks = 0"],"sourceRoot":""}